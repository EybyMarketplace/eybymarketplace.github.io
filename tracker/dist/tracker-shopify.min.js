/* Influencer Tracker v2.0.0 | Built: 2025-07-23T20:08:11.508Z */
!function(t,e,n){"use strict";void 0!==t&&(t.InfluencerTrackerBuild={name:"shopify",version:"2.0.0",timestamp:"2025-07-23T20:08:11.520Z",files:["src/core/tracker-core.js","src/adapters/shopify-adapter.js","src/utils/helpers.js"]}),function(t,e){const n={apiEndpoint:"",projectId:"",enableConsentCheck:!0,batchSize:10,batchTimeout:3e3,sessionTimeout:18e5,version:"2.0.0"},a={checkConsent:function(){return!n.enableConsentCheck||"granted"===localStorage.getItem("analytics_consent")},waitForConsent:function(t){const e=setInterval(()=>{this.checkConsent()&&(clearInterval(e),t())},500);setTimeout(()=>{clearInterval(e)},1e4)}},r={generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},getUserId:function(){let t=localStorage.getItem("inf_user_id");return t||(t=this.generateUUID(),localStorage.setItem("inf_user_id",t)),t},getSessionId:function(){let t=sessionStorage.getItem("inf_session");if(t){const e=JSON.parse(t),a=Date.now();if(a-e.lastActivity<n.sessionTimeout)return e.lastActivity=a,sessionStorage.setItem("inf_session",JSON.stringify(e)),e.id}const e={id:this.generateUUID(),startTime:Date.now(),lastActivity:Date.now()};return sessionStorage.setItem("inf_session",JSON.stringify(e)),e.id}},o={detectInfluencer:function(){const n=new URLSearchParams(t.location.search),a=new URLSearchParams(t.location.hash.substring(1)),r={influencer_id:n.get("inf_id")||n.get("influencer")||a.get("inf_id"),campaign_id:n.get("camp_id")||n.get("campaign")||a.get("camp_id"),promo_code:n.get("promo")||n.get("codigo")||a.get("promo"),utm_source:n.get("utm_source"),utm_medium:n.get("utm_medium"),utm_campaign:n.get("utm_campaign"),ref:n.get("ref")},o=e.referrer;let i=null;if(o.includes("instagram.com")?i="instagram":o.includes("tiktok.com")?i="tiktok":o.includes("youtube.com")||o.includes("youtu.be")?i="youtube":o.includes("facebook.com")?i="facebook":(o.includes("twitter.com")||o.includes("x.com"))&&(i="twitter"),Object.values(r).some(t=>null!==t)||i){const e={...r,social_source:i,detected_at:Date.now(),landing_page:t.location.href};return sessionStorage.setItem("inf_attribution",JSON.stringify(e)),e}const c=sessionStorage.getItem("inf_attribution");return c?JSON.parse(c):null}},i={generate:function(){const e=t.screen,n=navigator;return{user_agent:n.userAgent,language:n.language,platform:n.platform,screen_resolution:`${e.width}x${e.height}`,color_depth:e.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,device_memory:n.deviceMemory||null,hardware_concurrency:n.hardwareConcurrency||null,connection:n.connection?{effective_type:n.connection.effectiveType,downlink:n.connection.downlink}:null}}},c={queue:[],add:function(t){this.queue.push(t),this.queue.length>=n.batchSize&&this.flush()},flush:function(){if(0===this.queue.length||!n.apiEndpoint)return;const t=this.queue.splice(0,n.batchSize);fetch(n.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:n.projectId,events:t,version:n.version})}).catch(e=>{console.warn("Influencer Tracker: Failed to send events",e);const n=JSON.parse(localStorage.getItem("inf_failed_events")||"[]");n.push(...t),localStorage.setItem("inf_failed_events",JSON.stringify(n.slice(-100)))})},scheduleFlush:function(){this.flushTimer&&clearTimeout(this.flushTimer),this.flushTimer=setTimeout(()=>this.flush(),n.batchTimeout)}},InfluencerTracker={initialized:!1,startTime:Date.now(),platform:"generic",adapter:null,init:function(t={}){this.initialized||(Object.assign(n,t),n.apiEndpoint?(this.platform=this.detectPlatform(),console.log(`ðŸŽ¯ Plataforma detectada: ${this.platform}`),this.adapter=this.loadAdapter(this.platform),!n.enableConsentCheck||a.checkConsent()?this.startTracking():a.waitForConsent(()=>this.startTracking())):console.warn("Influencer Tracker: apiEndpoint nÃ£o configurado"))},detectPlatform:function(){return t.Shopify||t.shopifyData||e.querySelector('meta[name="shopify-checkout-api-token"]')?"shopify":"generic"},loadAdapter:function(e){return t[`${e}Adapter`]||null},startTracking:function(){this.initialized=!0;const n=o.detectInfluencer();this.track("page_view",{page_url:t.location.href,page_title:e.title,referrer:e.referrer,influencer_data:n}),this.setupUniversalTracking(),this.adapter?.init&&this.adapter.init(),c.scheduleFlush(),t.addEventListener("beforeunload",()=>c.flush()),console.log("Influencer Tracker: Inicializado com sucesso")},track:function(e,n={}){if(!this.initialized)return;const a={event_id:r.generateUUID(),event_type:e,timestamp:Date.now(),user_id:r.getUserId(),session_id:r.getSessionId(),page_url:t.location.href,device_fingerprint:i.generate(),platform:this.platform,properties:n};this.adapter?.enrichEvent&&Object.assign(a.properties,this.adapter.enrichEvent(e,n)),c.add(a)},setupUniversalTracking:function(){let n=0;t.addEventListener("scroll",this.throttle(()=>{const a=Math.round(t.scrollY/(e.body.scrollHeight-t.innerHeight)*100);a>n&&(n=a,[25,50,75,90].includes(a)&&this.track("scroll_milestone",{scroll_percent:a}))},1e3));let a=0;setInterval(()=>{a+=10,[30,60,120,300].includes(a)&&this.track("time_milestone",{seconds_on_page:a})},1e4),this.setupExitTracking()},setupExitTracking:function(){let n=!1;e.addEventListener("mouseleave",a=>{a.clientY<=0&&!n&&(n=!0,this.track("exit_intent",{time_on_page:Date.now()-this.startTime,scroll_percent:Math.round(t.scrollY/(e.body.scrollHeight-t.innerHeight)*100)}))})},trackPurchase:function(t){this.track("purchase",{order_id:t.orderId,total_value:t.totalValue,currency:t.currency||"BRL",items:t.items,coupon_code:t.couponCode,influencer_attribution:JSON.parse(sessionStorage.getItem("inf_attribution")||"null")})},trackCustomEvent:function(t,e){this.track(t,e)},throttle:function(t,e){let n;return function(){const a=arguments;n||(t.apply(this,a),n=!0,setTimeout(()=>n=!1,e))}}};t.InfluencerTracker=InfluencerTracker,t.InfluencerTracker.ConsentManager=a,t.InfluencerTracker.IdGenerator=r,t.InfluencerTracker.InfluencerDetector=o,t.InfluencerTracker.DeviceFingerprint=i,t.InfluencerTracker.EventQueue=c}(t,e),function(t,e){t.shopifyAdapter={lastCartState:null,cartUpdateTimeout:null,init:function(){console.log("ðŸ›ï¸ Inicializando adaptador Shopify"),this.setupShopifyTracking(),this.setupCartTracking(),this.setupProductTracking(),this.setupCheckoutTracking(),this.lastCartState={items:this.getCartItemCount(),value:this.getCartValue()},console.log("ðŸ›’ Estado inicial do carrinho:",this.lastCartState)},enrichEvent:function(e,n){const a={shop_domain:t.Shopify?.shop||t.shopifyData?.shop?.domain,currency:t.shopifyData?.shop?.currency||"USD",customer_id:t.shopifyData?.customer?.id,cart_token:this.getCartToken()};return"cart_update"===e&&(a.cart_items=this.getCartItemCount(),a.cart_value=this.getCartValue()),"product_view"===e&&t.shopifyData?.product&&(a.product_id=t.shopifyData.product.id,a.product_handle=t.shopifyData.product.handle,a.product_type=t.shopifyData.product.type,a.product_vendor=t.shopifyData.product.vendor,a.product_price=t.shopifyData.product.price,a.product_available=t.shopifyData.product.available),a},getCartValue:function(){if(console.log("ðŸ›’ getCartValue (Shopify)"),t.shopifyData?.cart?.total_price!==n){const e=t.shopifyData.cart.total_price;return console.log("   âœ… Via Shopify data:",e),e}try{const t=new XMLHttpRequest;if(t.open("GET","/cart.js",!1),t.send(),200===t.status){const e=JSON.parse(t.responseText).total_price/100;return console.log("   âœ… Via API /cart.js:",e),e}}catch(t){console.log("   âŒ Erro API:",t)}const a=["[data-cart-total]",".cart-total","#cart-total",".basket-total",".cart__total",".drawer-cart__total"];for(const t of a){const n=e.querySelector(t);if(n){const t=n.textContent||n.value||n.getAttribute("data-cart-total");if(t){const e=this.parseCartValue(t);if(null!==e)return console.log("   âœ… Via DOM:",e),e}}}return console.log("   âš ï¸ Fallback para 0"),0},getCartItemCount:function(){if(t.shopifyData?.cart?.item_count!==n)return t.shopifyData.cart.item_count;try{const t=new XMLHttpRequest;if(t.open("GET","/cart.js",!1),t.send(),200===t.status)return JSON.parse(t.responseText).item_count}catch(t){console.log("Erro ao buscar item count:",t)}return e.querySelectorAll("[data-cart-item], .cart-item, .line-item").length},getCartToken:function(){try{const t=new XMLHttpRequest;if(t.open("GET","/cart.js",!1),t.send(),200===t.status)return JSON.parse(t.responseText).token}catch(t){return null}},parseCartValue:function(t){if(!t)return null;let e=(t=String(t).trim()).replace(/[^\d.,\-]/g,"");if(e.includes(",")&&e.includes("."))e=e.lastIndexOf(",")>e.lastIndexOf(".")?e.replace(/\./g,"").replace(",","."):e.replace(/,/g,"");else if(e.includes(",")){const t=e.split(",");e=2===t.length&&t[1].length<=2?e.replace(",","."):e.replace(/,/g,"")}const n=parseFloat(e);return n>1e4?n/100:isNaN(n)?null:n},setupShopifyTracking:function(){const e=t.InfluencerTracker;"product"===t.shopifyData?.page?.type&&e.trackCustomEvent("product_view",{product_id:t.shopifyData.product?.id,product_handle:t.shopifyData.product?.handle,product_title:t.shopifyData.product?.title,product_price:t.shopifyData.product?.price,product_type:t.shopifyData.product?.type,product_vendor:t.shopifyData.product?.vendor,product_available:t.shopifyData.product?.available,variants_count:t.shopifyData.product?.variants?.length}),"collection"===t.shopifyData?.page?.type&&e.trackCustomEvent("collection_view",{collection_id:t.shopifyData.collection?.id,collection_handle:t.shopifyData.collection?.handle,collection_title:t.shopifyData.collection?.title,products_count:t.shopifyData.collection?.products_count}),"cart"===t.shopifyData?.page?.type&&e.trackCustomEvent("cart_view",{cart_items:t.shopifyData.cart?.item_count||0,cart_total:t.shopifyData.cart?.total_price||0,cart_items_detail:t.shopifyData.cart?.items||[]})},setupCartTracking:function(){t.InfluencerTracker,console.log("ðŸ›’ Setup cart tracking (sem event listeners de click/submit)");const n=new MutationObserver(t=>{let e=!1;t.forEach(t=>{"childList"===t.type&&[...t.addedNodes,...t.removedNodes].some(t=>t.nodeType===Node.ELEMENT_NODE&&(t.matches?.("[data-cart-item], .cart-item, .line-item")||t.querySelector?.("[data-cart-item], .cart-item, .line-item")||t.classList?.contains("cart-item")))&&(e=!0),"attributes"===t.type&&["data-cart-item","data-quantity","data-cart-total"].includes(t.attributeName)&&(e=!0)}),e&&this.checkCartChange("dom_mutation")});let a=0;["[data-cart-container]",".cart-drawer",".mini-cart",".cart-items",".cart",".cart-form"].forEach(t=>{const r=e.querySelector(t);r&&(n.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-cart-item","data-quantity","data-cart-total"]}),a++,console.log(`ðŸ‘€ Observando container: ${t}`))}),0===a&&(n.observe(e.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-cart-item","data-quantity","data-cart-total"]}),console.log("ðŸ‘€ Observando body como fallback")),setInterval(()=>{this.checkCartChange("periodic_check")},45e3),this.lastCartState={items:this.getCartItemCount(),value:this.getCartValue()},console.log("ðŸ›’ Estado inicial do carrinho:",this.lastCartState),console.log(`âœ… Cart tracking ativo (${a} containers observados)`)},setupProductTracking:function(){const n=t.InfluencerTracker,a=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const e=t.target;n.trackCustomEvent("product_impression",{product_id:e.getAttribute("data-product-id"),product_handle:e.getAttribute("data-product-handle"),product_title:e.getAttribute("data-product-title"),product_price:e.getAttribute("data-product-price"),visibility_percent:Math.round(100*t.intersectionRatio),element_position:this.getElementPosition(e)})}})},{threshold:.5});["[data-product-id]",".product-item",".product-card",".grid-product",".product-grid-item"].forEach(t=>{e.querySelectorAll(t).forEach(t=>{a.observe(t)})}),e.addEventListener("change",e=>{if(e.target.matches('select[name="id"], input[name="id"], .product-form__variants select')){const a=e.target.value;n.trackCustomEvent("variant_selection",{product_id:t.shopifyData?.product?.id,variant_id:a,selection_method:e.target.tagName.toLowerCase()})}})},setupCheckoutTracking:function(){const e=t.InfluencerTracker;t.location.pathname.includes("/checkout")&&(e.trackCustomEvent("checkout_page_view",{checkout_step:this.getCheckoutStep(),cart_items:this.getCartItemCount(),cart_value:this.getCartValue()}),this.setupCheckoutStepTracking()),(t.location.pathname.includes("/thank_you")||t.location.pathname.includes("/orders/"))&&this.trackPurchaseCompletion()},setupCheckoutStepTracking:function(){const n=t.InfluencerTracker,a=new MutationObserver(()=>{const t=this.getCheckoutStep();this.lastCheckoutStep!==t&&(n.trackCustomEvent("shopify_checkout_step_change",{previous_step:this.lastCheckoutStep,current_step:t,cart_items:this.getCartItemCount(),cart_value:this.getCartValue()}),this.lastCheckoutStep=t)}),r=e.querySelector(".checkout, #checkout, .main-content")||e.body;a.observe(r,{childList:!0,subtree:!0})},checkCartChange:function(e){this.cartUpdateTimeout&&clearTimeout(this.cartUpdateTimeout),this.cartUpdateTimeout=setTimeout(()=>{const n={items:this.getCartItemCount(),value:this.getCartValue()};(!this.lastCartState||n.items!==this.lastCartState.items||Math.abs(n.value-this.lastCartState.value)>.01)&&(console.log("ðŸ›’ Cart mudou:",this.lastCartState,"â†’",n),t.InfluencerTracker.track("cart_update",{cart_items:n.items,cart_value:n.value,previous_items:this.lastCartState?.items||0,previous_value:this.lastCartState?.value||0,change_trigger:e,change_type:n.items>(this.lastCartState?.items||0)?"add":n.items<(this.lastCartState?.items||0)?"remove":"update"}),this.lastCartState=n)},1e3)},getCheckoutStep:function(){return e.querySelector('.step-contact, [data-step="contact"]')?"contact":e.querySelector('.step-shipping, [data-step="shipping"]')?"shipping":e.querySelector('.step-payment, [data-step="payment"]')?"payment":e.querySelector('.step-review, [data-step="review"]')?"review":"unknown"},getElementPosition:function(t){const e=t.getBoundingClientRect();return{x:e.left,y:e.top,width:e.width,height:e.height}},trackPurchaseCompletion:function(){const e=t.InfluencerTracker,n=this.extractOrderData();e.trackCustomEvent("purchase_completed",{...n,influencer_attribution:JSON.parse(sessionStorage.getItem("inf_attribution")||"null"),page_url:t.location.href}),n.order_id&&e.trackPurchase({orderId:n.order_id,totalValue:n.total_value,currency:n.currency,items:n.items,couponCode:n.coupon_code})},extractOrderData:function(){if(t.Shopify?.checkout)return{order_id:t.Shopify.checkout.order_id,total_value:t.Shopify.checkout.total_price/100,currency:t.Shopify.checkout.currency,items:t.Shopify.checkout.line_items,coupon_code:t.Shopify.checkout.discount?.code};const n=e.querySelector(".order-number, [data-order-number]")?.textContent,a=e.querySelector(".total-price, [data-total-price]");return{order_id:n,total_value:a?this.parseCartValue(a.textContent):0,currency:"USD",items:[],coupon_code:null}}}}(t,e),function(t){t.InfluencerTrackerUtils={debounce:function(t,e,n){let a;return function(){const r=this,o=arguments,i=n&&!a;clearTimeout(a),a=setTimeout(function(){a=null,n||t.apply(r,o)},e),i&&t.apply(r,o)}},throttle:function(t,e){let n;return function(){const a=arguments;n||(t.apply(this,a),n=!0,setTimeout(()=>n=!1,e))}},getElementPosition:function(t){const e=t.getBoundingClientRect();return{x:Math.round(e.left),y:Math.round(e.top),width:Math.round(e.width),height:Math.round(e.height)}},parseCurrency:function(t){if(!t)return null;let e=(t=String(t).trim()).replace(/[^\d.,\-]/g,"");if(e.includes(",")&&e.includes("."))e=e.lastIndexOf(",")>e.lastIndexOf(".")?e.replace(/\./g,"").replace(",","."):e.replace(/,/g,"");else if(e.includes(",")){const t=e.split(",");e=2===t.length&&t[1].length<=2?e.replace(",","."):e.replace(/,/g,"")}const n=parseFloat(e);return n>1e4?n/100:isNaN(n)?null:n},isElementVisible:function(n){const a=n.getBoundingClientRect();return a.top>=0&&a.left>=0&&a.bottom<=(t.innerHeight||e.documentElement.clientHeight)&&a.right<=(t.innerWidth||e.documentElement.clientWidth)},getScrollPercentage:function(){const n=t.pageYOffset||e.documentElement.scrollTop,a=e.documentElement.scrollHeight-t.innerHeight;return Math.round(n/a*100)},setCookie:function(t,n,a){const r=a?`; expires=${new Date(Date.now()+864e5*a).toUTCString()}`:"";e.cookie=`${t}=${n}${r}; path=/`},getCookie:function(t){return e.cookie.split("; ").reduce((e,n)=>{const a=n.split("=");return a[0]===t?decodeURIComponent(a[1]):e},"")},setStorage:function(t,e,n=!1){try{return(n?sessionStorage:localStorage).setItem(t,JSON.stringify(e)),!0}catch(a){return console.warn("Storage not available, using cookie fallback"),this.setCookie(t,JSON.stringify(e),n?null:30),!1}},getStorage:function(t,e=!1){try{const n=(e?sessionStorage:localStorage).getItem(t);return n?JSON.parse(n):null}catch(e){const n=this.getCookie(t);return n?JSON.parse(n):null}}}}(t)}("undefined"!=typeof window?window:this,"undefined"!=typeof document?document:{});