/* Influencer Tracker v2.1.0 for Shopify | Built: 2025-09-03T18:16:01.761Z */
!function(e,t){"use strict";e.InfluencerTracker=e.InfluencerTracker||{},e.InfluencerTracker.BuildInfo={name:"shopify-full",version:"2.1.0",platform:"shopify",timestamp:"2025-09-03T18:16:01.769Z",modules:["modules/config.js","utils/utils.js","modules/consent-manager.js","modules/id-generator.js","modules/influencer-detector.js","modules/device-fingerprint.js","modules/event-queue.js","core/tracker-core.js"],features:{tracking:!0,attribution:!0,shopify:!0,ai:!0}},global.InfluencerTracker=global.InfluencerTracker||{},global.InfluencerTracker.Config={defaults:{apiEndpoint:"",projectId:"",enableConsentCheck:!0,batchSize:10,batchTimeout:3e3,sessionTimeout:18e5,version:"2.0.0"},current:{},init:function(){this.current=Object.assign({},this.defaults)},update:function(e={}){Object.assign(this.current,e)},get:function(e){return this.current[e]},getAll:function(){return Object.assign({},this.current)},isValid:function(){return!(!this.current.apiEndpoint||!this.current.projectId)}},global.InfluencerTracker.Config.init(),global.InfluencerTracker=global.InfluencerTracker||{},global.InfluencerTracker.Utils={throttle:function(e,t){let n;return function(){const r=arguments;n||(e.apply(this,r),n=!0,setTimeout(()=>n=!1,t))}},debounce:function(e,t,n){let r;return function(){const i=this,o=arguments,a=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,o)},t),a&&e.apply(i,o)}},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isTablet:function(){return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(navigator.userAgent)},getDeviceType:function(){return this.isMobile()?"mobile":this.isTablet()?"tablet":"desktop"},isElementVisible:function(n){const r=n.getBoundingClientRect();return r.top>=0&&r.left>=0&&r.bottom<=(e.innerHeight||t.documentElement.clientHeight)&&r.right<=(e.innerWidth||t.documentElement.clientWidth)},getScrollPercentage:function(){const n=e.pageYOffset||t.documentElement.scrollTop,r=t.documentElement.scrollHeight-e.innerHeight;return Math.round(n/r*100)},getUrlParams:function(){const t={},n=new URLSearchParams(e.location.search);for(const[e,r]of n)t[e]=r;return t},sanitizeString:function(e){return"string"!=typeof e?e:e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim()},isValidEmail:function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)},formatTimestamp:function(e){return new Date(e).toISOString()},deepMerge:function(e,t){const n=Object.assign({},e);for(const e in t)t.hasOwnProperty(e)&&("object"!=typeof t[e]||null===t[e]||Array.isArray(t[e])?n[e]=t[e]:n[e]=this.deepMerge(n[e]||{},t[e]));return n}},global.InfluencerTracker=global.InfluencerTracker||{},global.InfluencerTracker.ConsentManager={CONSENT_KEY:"analytics_consent",CONSENT_DATE_KEY:"analytics_consent_date",pendingCallbacks:[],checkConsent:function(){if(!global.InfluencerTracker.Config.get("enableConsentCheck"))return!0;const e=localStorage.getItem(this.CONSENT_KEY),t=localStorage.getItem(this.CONSENT_DATE_KEY);if("granted"===e&&t){const e=Date.now()-31536e6;return parseInt(t)>e}return!1},waitForConsent:function(e,t=1e4){if(this.checkConsent())return void e();this.pendingCallbacks.push(e);const n=Date.now(),r=setInterval(()=>{this.checkConsent()?(clearInterval(r),this.triggerPendingCallbacks()):Date.now()-n>t&&(clearInterval(r),console.warn("Influencer Tracker: Consent timeout reached"))},500)},setConsent:function(e=!0){localStorage.setItem(this.CONSENT_KEY,e?"granted":"denied"),localStorage.setItem(this.CONSENT_DATE_KEY,Date.now().toString()),e&&this.triggerPendingCallbacks()},triggerPendingCallbacks:function(){this.pendingCallbacks.forEach(e=>{try{e()}catch(e){console.error("Consent callback error:",e)}}),this.pendingCallbacks=[]},revokeConsent:function(){localStorage.removeItem(this.CONSENT_KEY),localStorage.removeItem(this.CONSENT_DATE_KEY)}},global.InfluencerTracker=global.InfluencerTracker||{},global.InfluencerTracker.IdGenerator={USER_ID_KEY:"inf_user_id",SESSION_KEY:"inf_session",generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getUserId:function(){let e=localStorage.getItem(this.USER_ID_KEY);return e||(e=this.generateUUID(),localStorage.setItem(this.USER_ID_KEY,e)),e},getSessionId:function(){let e=sessionStorage.getItem(this.SESSION_KEY);const t=global.InfluencerTracker.Config.get("sessionTimeout");if(e)try{const n=JSON.parse(e),r=Date.now();if(r-n.lastActivity<t)return n.lastActivity=r,sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(n)),n.id}catch(e){console.warn("Invalid session data, creating new session")}const n={id:this.generateUUID(),startTime:Date.now(),lastActivity:Date.now()};return sessionStorage.setItem(this.SESSION_KEY,JSON.stringify(n)),n.id},getSessionInfo:function(){const e=sessionStorage.getItem(this.SESSION_KEY);if(e)try{return JSON.parse(e)}catch(e){return null}return null},invalidateSession:function(){sessionStorage.removeItem(this.SESSION_KEY)}},global.InfluencerTracker=global.InfluencerTracker||{},global.InfluencerTracker.InfluencerDetector={ATTRIBUTION_KEY:"inf_attribution",socialNetworks:{"instagram.com":"instagram","tiktok.com":"tiktok","youtube.com":"youtube","youtu.be":"youtube","facebook.com":"facebook","twitter.com":"twitter","x.com":"twitter","linkedin.com":"linkedin","pinterest.com":"pinterest","snapchat.com":"snapchat"},detectInfluencer:function(){const n=new URLSearchParams(e.location.search),r=new URLSearchParams(e.location.hash.substring(1)),i={influencer_id:this.getParam(n,r,["inf_id","influencer","inf"]),campaign_id:this.getParam(n,r,["camp_id","campaign","cmp"]),promo_code:this.getParam(n,r,["promo","codigo","discount"]),utm_source:n.get("utm_source"),utm_medium:n.get("utm_medium"),utm_campaign:n.get("utm_campaign"),utm_content:n.get("utm_content"),utm_term:n.get("utm_term"),ref:n.get("ref"),affiliate_id:this.getParam(n,r,["aff_id","affiliate"])},o=this.detectSocialSource();if(Object.values(i).some(e=>null!==e&&""!==e)||o){const n={...i,social_source:o,detected_at:Date.now(),landing_page:e.location.href,referrer:t.referrer,user_agent:navigator.userAgent};return sessionStorage.setItem(this.ATTRIBUTION_KEY,JSON.stringify(n)),n}return this.getSavedAttribution()},getParam:function(e,t,n){for(const r of n){const n=e.get(r)||t.get(r);if(n)return n}return null},detectSocialSource:function(){const e=t.referrer;if(!e)return null;try{const t=new URL(e).hostname.toLowerCase();for(const[e,n]of Object.entries(this.socialNetworks))if(t.includes(e))return n}catch(e){console.warn("Error parsing referrer:",e)}return null},getSavedAttribution:function(){try{const e=sessionStorage.getItem(this.ATTRIBUTION_KEY);return e?JSON.parse(e):null}catch(e){return console.warn("Error parsing saved attribution:",e),null}},clearAttribution:function(){sessionStorage.removeItem(this.ATTRIBUTION_KEY)},hasActiveAttribution:function(){return!!this.getSavedAttribution()}},global.InfluencerTracker=global.InfluencerTracker||{},global.InfluencerTracker.DeviceFingerprint={cachedFingerprint:null,generate:function(){if(this.cachedFingerprint)return this.cachedFingerprint;const t=e.screen,n=navigator,r={user_agent:n.userAgent,language:n.language,languages:n.languages?n.languages.join(","):null,platform:n.platform,screen_resolution:`${t.width}x${t.height}`,screen_available:`${t.availWidth}x${t.availHeight}`,color_depth:t.colorDepth,pixel_depth:t.pixelDepth,timezone:this.getTimezone(),timezone_offset:(new Date).getTimezoneOffset(),device_memory:n.deviceMemory||null,hardware_concurrency:n.hardwareConcurrency||null,max_touch_points:n.maxTouchPoints||null,connection:this.getConnectionInfo(),cookies_enabled:n.cookieEnabled,local_storage:this.hasLocalStorage(),session_storage:this.hasSessionStorage(),viewport:this.getViewportInfo(),plugins_count:n.plugins?n.plugins.length:0,generated_at:Date.now()};return this.cachedFingerprint=r,r},getTimezone:function(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return null}},getConnectionInfo:function(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e?{effective_type:e.effectiveType||null,downlink:e.downlink||null,rtt:e.rtt||null,save_data:e.saveData||!1}:null},hasLocalStorage:function(){try{const e="__test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}},hasSessionStorage:function(){try{const e="__test__";return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),!0}catch(e){return!1}},getViewportInfo:function(){return{width:e.innerWidth||t.documentElement.clientWidth,height:e.innerHeight||t.documentElement.clientHeight,device_pixel_ratio:e.devicePixelRatio||1}},generateHash:function(){const e=this.generate(),t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n&=n;return Math.abs(n).toString(36)},clearCache:function(){this.cachedFingerprint=null}},global.InfluencerTracker=global.InfluencerTracker||{},global.InfluencerTracker.EventQueue={queue:[],flushTimer:null,isOnline:navigator.onLine,FAILED_EVENTS_KEY:"inf_failed_events",init:function(){this.setupNetworkListeners(),this.retryFailedEvents()},setupNetworkListeners:function(){const t=this;e.addEventListener("online",function(){t.isOnline=!0,t.retryFailedEvents(),t.queue.length>0&&t.flush()}),e.addEventListener("offline",function(){t.isOnline=!1})},add:function(e){this.queue.push(e);const t=global.InfluencerTracker.Config.get("batchSize");this.queue.length>=t?this.flush():this.scheduleFlush()},scheduleFlush:function(){this.flushTimer&&clearTimeout(this.flushTimer);const e=global.InfluencerTracker.Config.get("batchTimeout");this.flushTimer=setTimeout(()=>{this.flush()},e)},flush:function(){if(0===this.queue.length)return Promise.resolve();const e=global.InfluencerTracker.Config,t=e.get("apiEndpoint"),n=e.get("projectId");if(!t)return console.warn("Influencer Tracker: API endpoint not configured"),Promise.reject(new Error("API endpoint not configured"));const r=this.queue.splice(0,e.get("batchSize")),i={project_id:n,events:r,version:e.get("version"),timestamp:Date.now()};return this.sendEvents(i,r)},sendEvents:function(e,t){const n=global.InfluencerTracker.Config;return fetch(n.get("apiEndpoint"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return e.json()}).catch(e=>{throw console.warn("Influencer Tracker: Failed to send events",e),this.saveFailedEvents(t),e})},saveFailedEvents:function(e){try{const t=JSON.parse(localStorage.getItem(this.FAILED_EVENTS_KEY)||"[]");t.push(...e);const n=t.slice(-100);localStorage.setItem(this.FAILED_EVENTS_KEY,JSON.stringify(n))}catch(e){console.warn("Failed to save failed events:",e)}},retryFailedEvents:function(){if(this.isOnline)try{const e=JSON.parse(localStorage.getItem(this.FAILED_EVENTS_KEY)||"[]");e.length>0&&(console.log(`Retrying ${e.length} failed events`),this.queue.unshift(...e),localStorage.removeItem(this.FAILED_EVENTS_KEY),this.flush())}catch(e){console.warn("Error retrying failed events:",e)}},getQueueSize:function(){return this.queue.length},clear:function(){this.queue=[],this.flushTimer&&(clearTimeout(this.flushTimer),this.flushTimer=null)},forceFlush:function(){return this.flushTimer&&(clearTimeout(this.flushTimer),this.flushTimer=null),this.flush()}};const n=global.InfluencerTracker.Config,r=global.InfluencerTracker.ConsentManager,i=global.InfluencerTracker.IdGenerator,o=global.InfluencerTracker.InfluencerDetector,a=global.InfluencerTracker.DeviceFingerprint,s=global.InfluencerTracker.EventQueue,c=global.InfluencerTracker.Utils;global.InfluencerTracker.Core={initialized:!1,startTime:Date.now(),platform:"generic",adapter:null,init:function(e={}){this.initialized?console.warn("Influencer Tracker already initialized"):(n.update(e),n.isValid()?(s.init(),this.platform=this.detectPlatform(),console.log(`🎯 Plataforma detectada: ${this.platform}`),this.adapter=this.loadAdapter(this.platform),!n.get("enableConsentCheck")||r.checkConsent()?this.startTracking():r.waitForConsent(()=>this.startTracking())):console.warn("Influencer Tracker: Invalid configuration - missing apiEndpoint or projectId"))},detectPlatform:function(){return e.Shopify||e.shopifyData||t.querySelector('meta[name="shopify-checkout-api-token"]')?"shopify":e.vtex||e.vtexjs||t.querySelector('meta[name="vtex-version"]')?"vtex":e.LS||t.querySelector('meta[name="nuvemshop"]')?"nuvemshop":e.wc||t.querySelector('meta[name="generator"][content*="WooCommerce"]')?"woocommerce":"generic"},loadAdapter:function(e){return global[`${e}Adapter`]||null},startTracking:function(){this.initialized=!0;const n=o.detectInfluencer();this.track("page_view",{page_url:e.location.href,page_title:t.title,referrer:t.referrer,influencer_data:n,device_type:c.getDeviceType(),viewport:a.generate().viewport}),this.setupUniversalTracking(),this.adapter&&this.adapter.init&&this.adapter.init(),e.addEventListener("beforeunload",()=>{s.forceFlush()}),t.addEventListener("visibilitychange",()=>{"hidden"===t.visibilityState&&s.forceFlush()}),console.log("🎯 Influencer Tracker: Inicializado com sucesso")},track:function(t,n={}){if(!this.initialized)return void console.warn("Tracker not initialized");const r={event_id:i.generateUUID(),event_type:t,timestamp:Date.now(),user_id:i.getUserId(),session_id:i.getSessionId(),page_url:e.location.href,device_fingerprint:a.generate(),platform:this.platform,properties:c.deepMerge({},n)};if(this.adapter&&this.adapter.enrichEvent){const e=this.adapter.enrichEvent(t,n);r.properties=c.deepMerge(r.properties,e)}s.add(r)},setupUniversalTracking:function(){let t=0;e.addEventListener("scroll",c.throttle(()=>{const e=c.getScrollPercentage();e>t&&(t=e,[25,50,75,90].includes(e)&&this.track("scroll_milestone",{scroll_percent:e,max_scroll:t}))},1e3));let n=0;const r=setInterval(()=>{n+=10,[30,60,120,300].includes(n)&&this.track("time_milestone",{seconds_on_page:n,session_duration:Date.now()-this.startTime})},1e4);e.addEventListener("beforeunload",()=>{clearInterval(r)}),this.setupExitTracking()},setupExitTracking:function(){let n=!1;t.addEventListener("mouseleave",t=>{t.clientY<=0&&!n&&(n=!0,this.track("exit_intent",{time_on_page:Date.now()-this.startTime,scroll_percent:c.getScrollPercentage(),page_url:e.location.href}))})},trackPurchase:function(e){this.track("purchase",{order_id:e.orderId,total_value:e.totalValue,currency:e.currency||"BRL",items:e.items,coupon_code:e.couponCode,payment_method:e.paymentMethod,influencer_attribution:o.getSavedAttribution()})},trackCustomEvent:function(e,t){this.track(c.sanitizeString(e),t)},getInfo:function(){return{initialized:this.initialized,platform:this.platform,version:n.get("version"),userId:i.getUserId(),sessionId:i.getSessionId(),queueSize:s.getQueueSize(),hasAttribution:o.hasActiveAttribution()}}};const l=["Config","Utils","Core"].filter(t=>!e.InfluencerTracker[t]);if(l.length>0)console.error("Missing required modules:",l);else{e.InfluencerTracker.instance=e.InfluencerTracker.Core,e.InfluencerTracker.init=function(t){return e.InfluencerTracker.Core.init(t)},e.InfluencerTracker.track=function(t,n){return e.InfluencerTracker.Core.track(t,n)},e.InfluencerTracker.trackPurchase=function(t){return e.InfluencerTracker.Core.trackPurchase(t)},e.InfluencerTracker.getInfo=function(){return e.InfluencerTracker.Core.getInfo()};const n=t.currentScript;if(n&&"false"!==n.dataset.autoInit){const t={};n.dataset.apiEndpoint&&(t.apiEndpoint=n.dataset.apiEndpoint),n.dataset.projectId&&(t.projectId=n.dataset.projectId),Object.keys(t).length>0&&e.InfluencerTracker.init(t)}console.log("🎯 Influencer Tracker v2.1.0 for Shopify loaded"),console.log("📦 Modules loaded:",8),console.log("🛍️ Shopify integration: Ready"),console.log("🤖 AI analytics: Enabled")}}("undefined"!=typeof window?window:this,"undefined"!=typeof document?document:{});