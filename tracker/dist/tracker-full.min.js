/* Influencer Tracker v2.1.0 with AI | Built: 2025-09-02T18:09:16.070Z */
!function(t,e){"use strict";void 0!==t&&(t.InfluencerTrackerBuild={name:"full",version:"2.1.0",timestamp:"2025-09-02T18:09:16.078Z",files:["src/core/tracker-core.js","src/adapters/shopify-adapter.js","src/ai/ai-data-collector.js","src/utils/helpers.js"],features:{tracking:!0,attribution:!0,adapters:!0,ai:!0}}),function(t,e){const n={apiEndpoint:"",projectId:"",enableConsentCheck:!0,batchSize:10,batchTimeout:3e3,sessionTimeout:18e5,version:"2.0.0"},i={checkConsent:function(){return!n.enableConsentCheck||"granted"===localStorage.getItem("analytics_consent")},waitForConsent:function(t){const e=setInterval(()=>{this.checkConsent()&&(clearInterval(e),t())},500);setTimeout(()=>{clearInterval(e)},1e4)}},a={generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},getUserId:function(){let t=localStorage.getItem("inf_user_id");return t||(t=this.generateUUID(),localStorage.setItem("inf_user_id",t)),t},getSessionId:function(){let t=sessionStorage.getItem("inf_session");if(t){const e=JSON.parse(t),i=Date.now();if(i-e.lastActivity<n.sessionTimeout)return e.lastActivity=i,sessionStorage.setItem("inf_session",JSON.stringify(e)),e.id}const e={id:this.generateUUID(),startTime:Date.now(),lastActivity:Date.now()};return sessionStorage.setItem("inf_session",JSON.stringify(e)),e.id}},o={detectInfluencer:function(){const n=new URLSearchParams(t.location.search),i=new URLSearchParams(t.location.hash.substring(1)),a={influencer_id:n.get("inf_id")||n.get("influencer")||i.get("inf_id"),campaign_id:n.get("camp_id")||n.get("campaign")||i.get("camp_id"),promo_code:n.get("promo")||n.get("codigo")||i.get("promo"),utm_source:n.get("utm_source"),utm_medium:n.get("utm_medium"),utm_campaign:n.get("utm_campaign"),ref:n.get("ref")},o=e.referrer;let r=null;if(o.includes("instagram.com")?r="instagram":o.includes("tiktok.com")?r="tiktok":o.includes("youtube.com")||o.includes("youtu.be")?r="youtube":o.includes("facebook.com")?r="facebook":(o.includes("twitter.com")||o.includes("x.com"))&&(r="twitter"),Object.values(a).some(t=>null!==t)||r){const e={...a,social_source:r,detected_at:Date.now(),landing_page:t.location.href};return sessionStorage.setItem("inf_attribution",JSON.stringify(e)),e}const c=sessionStorage.getItem("inf_attribution");return c?JSON.parse(c):null}},r={generate:function(){const e=t.screen,n=navigator;return{user_agent:n.userAgent,language:n.language,platform:n.platform,screen_resolution:`${e.width}x${e.height}`,color_depth:e.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,device_memory:n.deviceMemory||null,hardware_concurrency:n.hardwareConcurrency||null,connection:n.connection?{effective_type:n.connection.effectiveType,downlink:n.connection.downlink}:null}}},c={queue:[],add:function(t){this.queue.push(t),this.queue.length>=n.batchSize&&this.flush()},flush:function(){if(0===this.queue.length||!n.apiEndpoint)return;const t=this.queue.splice(0,n.batchSize);fetch(n.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:n.projectId,events:t,version:n.version})}).catch(e=>{console.warn("Influencer Tracker: Failed to send events",e);const n=JSON.parse(localStorage.getItem("inf_failed_events")||"[]");n.push(...t),localStorage.setItem("inf_failed_events",JSON.stringify(n.slice(-100)))})},scheduleFlush:function(){this.flushTimer&&clearTimeout(this.flushTimer),this.flushTimer=setTimeout(()=>this.flush(),n.batchTimeout)}},InfluencerTracker={initialized:!1,startTime:Date.now(),platform:"generic",adapter:null,init:function(t={}){this.initialized||(Object.assign(n,t),n.apiEndpoint?(this.platform=this.detectPlatform(),console.log(`🎯 Plataforma detectada: ${this.platform}`),this.adapter=this.loadAdapter(this.platform),!n.enableConsentCheck||i.checkConsent()?this.startTracking():i.waitForConsent(()=>this.startTracking())):console.warn("Influencer Tracker: apiEndpoint não configurado"))},detectPlatform:function(){return t.Shopify||t.shopifyData||e.querySelector('meta[name="shopify-checkout-api-token"]')?"shopify":"generic"},loadAdapter:function(e){return t[`${e}Adapter`]||null},startTracking:function(){this.initialized=!0;const n=o.detectInfluencer();this.track("page_view",{page_url:t.location.href,page_title:e.title,referrer:e.referrer,influencer_data:n}),this.setupUniversalTracking(),this.adapter?.init&&this.adapter.init(),c.scheduleFlush(),t.addEventListener("beforeunload",()=>c.flush()),console.log("Influencer Tracker: Inicializado com sucesso")},track:function(e,n={}){if(!this.initialized)return;const i={event_id:a.generateUUID(),event_type:e,timestamp:Date.now(),user_id:a.getUserId(),session_id:a.getSessionId(),page_url:t.location.href,device_fingerprint:r.generate(),platform:this.platform,properties:n};this.adapter?.enrichEvent&&Object.assign(i.properties,this.adapter.enrichEvent(e,n)),c.add(i)},setupUniversalTracking:function(){let n=0;t.addEventListener("scroll",this.throttle(()=>{const i=Math.round(t.scrollY/(e.body.scrollHeight-t.innerHeight)*100);i>n&&(n=i,[25,50,75,90].includes(i)&&this.track("scroll_milestone",{scroll_percent:i}))},1e3));let i=0;setInterval(()=>{i+=10,[30,60,120,300].includes(i)&&this.track("time_milestone",{seconds_on_page:i})},1e4),this.setupExitTracking()},setupExitTracking:function(){let n=!1;e.addEventListener("mouseleave",i=>{i.clientY<=0&&!n&&(n=!0,this.track("exit_intent",{time_on_page:Date.now()-this.startTime,scroll_percent:Math.round(t.scrollY/(e.body.scrollHeight-t.innerHeight)*100)}))})},trackPurchase:function(t){this.track("purchase",{order_id:t.orderId,total_value:t.totalValue,currency:t.currency||"BRL",items:t.items,coupon_code:t.couponCode,influencer_attribution:JSON.parse(sessionStorage.getItem("inf_attribution")||"null")})},trackCustomEvent:function(t,e){this.track(t,e)},throttle:function(t,e){let n;return function(){const i=arguments;n||(t.apply(this,i),n=!0,setTimeout(()=>n=!1,e))}}};t.InfluencerTracker=InfluencerTracker,t.InfluencerTracker.ConsentManager=i,t.InfluencerTracker.IdGenerator=a,t.InfluencerTracker.InfluencerDetector=o,t.InfluencerTracker.DeviceFingerprint=r,t.InfluencerTracker.EventQueue=c}(t,e),function(t,e){const n={initialized:!1,startTime:Date.now(),lastCartState:null,lastScrollPercent:0,timeOnPage:0,exitTracked:!1,init:function(){this.initialized||(console.log("🔄 Inicializando Hybrid Shopify Tracker"),this.setupUniversalEcommerce(),this.setupBehavioralTracking(),this.setupShopifySpecific(),this.initializeState(),this.initialized=!0,console.log("✅ Hybrid Shopify Tracker inicializado"))},setupUniversalEcommerce:function(){console.log("🛒 Configurando tracking de ecommerce universal"),this.interceptShopifyAPIs(),this.listenToShopifyEvents(),this.setupSmartPolling()},interceptShopifyAPIs:function(){const e=this,n=t.fetch;t.fetch=async function(...t){const i=await n.apply(this,t);if(i.ok){const n="string"==typeof t[0]?t[0]:t[0].url;try{if(n.includes("/cart")){const t=i.clone();if(n.includes("/cart/add")){const i=await t.json();e.handleCartAdd(i,n)}else if(n.includes("/cart/update")||n.includes("/cart/change")){const i=await t.json();e.handleCartUpdate(i,n)}else if(n.includes("/cart/clear"))e.handleCartClear(n);else if(n.includes("/cart.js")||n.endsWith("/cart")){const i=await t.json();e.handleCartData(i,n)}}if(n.includes("/products/")&&n.includes(".js")){const t=await clonedResponse.json();e.handleProductData(t,n)}if(n.includes("/checkout")||n.includes("/orders")){const t=i.headers.get("content-type");if(t&&t.includes("application/json")){const t=await clonedResponse.json();e.handleCheckoutData(t,n)}}}catch(t){console.log("🔄 Erro ao processar resposta:",t)}}return i};const i=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(t,n,...a){return n.includes("/cart")&&this.addEventListener("load",function(){if(this.status>=200&&this.status<300)try{const t=JSON.parse(this.responseText);n.includes("/cart/add")?e.handleCartAdd(t,n):n.includes("/cart/update")||n.includes("/cart/change")?e.handleCartUpdate(t,n):n.includes("/cart.js")&&e.handleCartData(t,n)}catch(t){}}),i.apply(this,[t,n,...a])},console.log("✅ Interceptação de APIs configurada")},listenToShopifyEvents:function(){["cart:updated","cart:added","cart:removed","cart:changed","product:added-to-cart","ajaxCart:updated","drawer:updated"].forEach(t=>{e.addEventListener(t,e=>{console.log(`🛒 Evento Shopify detectado: ${t}`),setTimeout(()=>{this.refreshCartState("shopify_event",t,e.detail)},300)})}),t.jQuery&&(0,t.jQuery)(e).on("cart.requestComplete",(t,e)=>{console.log("🛒 Evento jQuery cart.requestComplete"),this.handleCartData(e,"jquery_event")})},setupSmartPolling:function(){let t=3e4;const n=async()=>{try{const t=await fetch("/cart.js");if(t.ok){const e=await t.json();this.handleCartData(e,"polling")}}catch(t){console.log("🔄 Erro no polling:",t)}};setInterval(()=>{const i=e.hasFocus()&&!e.hidden;t=i?2e4:6e4,n()},t),console.log("✅ Polling inteligente configurado")},handleCartAdd:function(t,e){console.log("🛒 Produto adicionado ao carrinho:",t),this.track("cart_add",{product_id:t.product_id,variant_id:t.variant_id||t.id,quantity:t.quantity||1,price:t.price?t.price/100:null,title:t.title||t.product_title,vendor:t.vendor,product_type:t.product_type,api_endpoint:e,timestamp:Date.now()}),setTimeout(()=>this.refreshCartState("cart_add"),500)},handleCartUpdate:function(t,e){console.log("🛒 Carrinho atualizado:",t),this.track("cart_update_action",{updates:t.updates||t,api_endpoint:e,timestamp:Date.now()}),setTimeout(()=>this.refreshCartState("cart_update"),500)},handleCartClear:function(t){console.log("🛒 Carrinho limpo"),this.track("cart_clear",{api_endpoint:t,timestamp:Date.now()}),setTimeout(()=>this.refreshCartState("cart_clear"),500)},handleCartData:function(t,e){const n={items:t.item_count||0,total:t.total_price?t.total_price/100:0,currency:t.currency||"USD",token:t.token};if(!this.lastCartState||n.items!==this.lastCartState.items||Math.abs(n.total-this.lastCartState.total)>.01){console.log("🛒 Estado do carrinho mudou:",this.lastCartState,"→",n);const i=this.determineChangeType(this.lastCartState,n);this.track("cart_update",{cart_items:n.items,cart_value:n.total,cart_currency:n.currency,cart_token:n.token,previous_items:this.lastCartState?.items||0,previous_value:this.lastCartState?.total||0,change_type:i,change_trigger:e,items_detail:t.items?t.items.map(t=>({product_id:t.product_id,variant_id:t.variant_id,quantity:t.quantity,price:t.price/100,line_price:t.line_price/100,title:t.title,vendor:t.vendor,product_type:t.product_type,handle:t.handle,sku:t.sku,grams:t.grams,properties:t.properties})):[],total_discount:t.total_discount?t.total_discount/100:0,discounts:t.cart_level_discount_applications||[],cart_note:t.note,cart_attributes:t.attributes||{},timestamp:Date.now()}),this.lastCartState=n}},handleProductData:function(t,e){console.log("📦 Dados de produto carregados:",t),this.track("product_data_loaded",{product_id:t.id,product_handle:t.handle,product_title:t.title,product_type:t.product_type,vendor:t.vendor,price_min:t.price_min/100,price_max:t.price_max/100,available:t.available,variants_count:t.variants?t.variants.length:0,images_count:t.images?t.images.length:0,tags:t.tags||[],api_endpoint:e,timestamp:Date.now()})},handleCheckoutData:function(t,e){console.log("💳 Dados de checkout:",t),this.track("checkout_data",{checkout_data:t,api_endpoint:e,timestamp:Date.now()})},setupBehavioralTracking:function(){console.log("👤 Configurando tracking comportamental"),this.trackScrollBehavior(),this.trackTimeOnPage(),this.trackExitIntent(),this.trackClickBehavior(),this.trackFormInteractions(),this.trackPageVisibility()},trackScrollBehavior:function(){t.addEventListener("scroll",this.throttle(()=>{const n=Math.round(t.scrollY/(e.body.scrollHeight-t.innerHeight)*100);n>this.lastScrollPercent&&(this.lastScrollPercent=n,[25,50,75,90].includes(n)&&this.track("scroll_milestone",{scroll_percent:n,scroll_depth:t.scrollY,page_height:e.body.scrollHeight,viewport_height:t.innerHeight,timestamp:Date.now()}))},1e3))},trackTimeOnPage:function(){setInterval(()=>{this.timeOnPage+=10,[30,60,120,300,600].includes(this.timeOnPage)&&this.track("time_milestone",{seconds_on_page:this.timeOnPage,minutes_on_page:Math.round(this.timeOnPage/60),is_active:e.hasFocus(),timestamp:Date.now()})},1e4)},trackExitIntent:function(){e.addEventListener("mouseleave",n=>{n.clientY<=0&&!this.exitTracked&&(this.exitTracked=!0,this.track("exit_intent",{time_on_page:Date.now()-this.startTime,scroll_percent:this.lastScrollPercent,page_url:t.location.href,referrer:e.referrer,timestamp:Date.now()}))})},trackClickBehavior:function(){e.addEventListener("click",this.throttle(t=>{const e=t.target;let n="generic";e.matches('a[href*="/products/"]')?n="product_link":e.matches('button[name="add"], input[name="add"]')?n="add_to_cart_button":e.matches('a[href*="/cart"], button[data-cart]')?n="cart_link":e.matches('a[href*="/checkout"]')&&(n="checkout_link"),this.track("click_event",{click_type:n,element_tag:e.tagName,element_class:e.className,element_id:e.id,element_text:e.textContent?.substring(0,100),href:e.href,position_x:t.clientX,position_y:t.clientY,timestamp:Date.now()})},500))},trackFormInteractions:function(){e.addEventListener("submit",t=>{const e=t.target;let n="generic";e.action&&e.action.includes("/cart/add")?n="add_to_cart":e.action&&e.action.includes("/contact")?n="contact":e.querySelector('input[type="email"]')&&(n="newsletter"),this.track("form_submit",{form_type:n,form_action:e.action,form_method:e.method,fields_count:e.elements.length,timestamp:Date.now()})})},trackPageVisibility:function(){e.addEventListener("visibilitychange",()=>{this.track("page_visibility_change",{is_visible:!e.hidden,time_on_page:Date.now()-this.startTime,timestamp:Date.now()})})},setupShopifySpecific:function(){console.log("🛍️ Configurando tracking específico do Shopify"),this.trackPageType(),this.trackCustomerData(),this.trackShopData(),this.trackVariantSelections()},trackPageType:function(){const n=t.location.pathname;let i="other";n.includes("/products/")?(i="product",this.trackProductView()):n.includes("/collections/")?(i="collection",this.trackCollectionView()):n.includes("/cart")?i="cart":n.includes("/checkout")?i="checkout":"/"!==n&&""!==n||(i="home"),this.track("page_view_detailed",{page_type:i,page_path:n,page_title:e.title,referrer:e.referrer,timestamp:Date.now()})},trackProductView:function(){const t=this.extractProductData();t&&this.track("product_view",{...t,timestamp:Date.now()})},trackCollectionView:function(){const t=this.extractCollectionData();t&&this.track("collection_view",{...t,timestamp:Date.now()})},trackVariantSelections:function(){['input[name="id"]','select[name="id"]',"[data-variant-id]",".product-variant-id"].forEach(t=>{e.querySelectorAll(t).forEach(t=>{t.addEventListener("change",()=>{this.track("variant_selection",{product_id:this.getProductId(),variant_id:t.value||t.dataset.variantId,product_handle:this.getProductHandle(),selection_method:t.tagName.toLowerCase(),timestamp:Date.now()})})})})},trackCustomerData:function(){const t=this.extractCustomerData();t&&this.track("customer_data",{...t,timestamp:Date.now()})},trackShopData:function(){const t=this.extractShopData();this.track("shop_data",{...t,timestamp:Date.now()})},refreshCartState:function(t,e=null,n=null){setTimeout(async()=>{try{const e=await fetch("/cart.js");if(e.ok){const n=await e.json();this.handleCartData(n,t)}}catch(t){console.log("🔄 Erro ao atualizar estado do carrinho:",t)}},300)},determineChangeType:function(t,e){return t?e.items>t.items?"add":e.items<t.items?"remove":Math.abs(e.total-t.total)>.01?"update":"unknown":"initial"},extractProductData:function(){const n={};if(t.product?(n.product_id=t.product.id,n.product_handle=t.product.handle,n.product_title=t.product.title,n.product_type=t.product.type,n.vendor=t.product.vendor,n.price=t.product.price/100,n.available=t.product.available,n.variants_count=t.product.variants?.length||0):t.meta?.product&&(n.product_id=t.meta.product.id,n.product_handle=t.meta.product.handle),!n.product_id){const t=e.querySelector('meta[property="product:retailer_item_id"]');t&&(n.product_id=t.content)}return Object.keys(n).length>0?n:null},extractCollectionData:function(){const e={};return t.collection&&(e.collection_id=t.collection.id,e.collection_handle=t.collection.handle,e.collection_title=t.collection.title,e.products_count=t.collection.products_count),Object.keys(e).length>0?e:null},extractCustomerData:function(){const e={};return t.customer?(e.customer_id=t.customer.id,e.customer_email=t.customer.email,e.customer_tags=t.customer.tags,e.orders_count=t.customer.orders_count,e.total_spent=t.customer.total_spent):t.Shopify?.customer&&(e.customer_id=t.Shopify.customer.id,e.customer_email=t.Shopify.customer.email),Object.keys(e).length>0?e:null},extractShopData:function(){return{shop_domain:t.Shopify?.shop||t.shopifyData?.shop?.domain,shop_currency:t.Shopify?.currency?.active||t.shopifyData?.shop?.currency,shop_money_format:t.Shopify?.money_format,shop_locale:t.Shopify?.locale}},getProductId:function(){if(t.product?.id)return t.product.id;if(t.meta?.product?.id)return t.meta.product.id;const n=e.querySelector('meta[property="product:retailer_item_id"]');return n?n.content:null},getProductHandle:function(){if(t.product?.handle)return t.product.handle;const e=t.location.pathname.split("/");return e[e.length-1]||null},initializeState:function(){fetch("/cart.js").then(t=>t.json()).then(t=>{this.lastCartState={items:t.item_count||0,total:t.total_price?t.total_price/100:0,currency:t.currency||"USD",token:t.token},console.log("🛒 Estado inicial do carrinho:",this.lastCartState)}).catch(t=>{console.log("⚠️ Erro ao carregar estado inicial do carrinho:",t),this.lastCartState={items:0,total:0,currency:"USD",token:null}})},track:function(e,n={}){t.InfluencerTracker&&t.InfluencerTracker.track?t.InfluencerTracker.track(e,n):console.log("📊 Evento rastreado:",e,n)},enrichEvent:function(t,e){return{...this.extractShopData(),...this.extractCustomerData(),platform_version:"hybrid",tracking_method:"universal_api"}},throttle:function(t,e){let n;return function(){const i=arguments;n||(t.apply(this,i),n=!0,setTimeout(()=>n=!1,e))}}};t.shopifyAdapter=n,console.log("🔄 Hybrid Shopify Tracker carregado")}(t,e),function(t,e){const n={sessionStart:Date.now(),behaviorMetrics:{pageViews:0,productViews:0,cartActions:0,totalClicks:0,scrollDepth:[],timeOnPages:[]},analyzeBehavior:function(){const t=Date.now()-this.sessionStart,e=this.behaviorMetrics;return{behavioral_segment:this.getBehavioralSegment(e,t),conversion_probability:this.getConversionProbability(e,t),engagement_quality:this.getEngagementQuality(e,t),device_tier:this.getDeviceTier(),attribution_confidence:this.getAttributionConfidence()}},getBehavioralSegment:function(t,e){return t.cartActions>0&&e<3e5?"decisive_buyer":t.cartActions>2?"hesitant_buyer":t.productViews>5&&0===t.cartActions?"researcher":t.totalClicks>10?"price_conscious":"casual_browser"},getConversionProbability:function(t,e){let n=0;return t.cartActions>0&&(n+=40),t.productViews>3&&(n+=20),e>18e4&&(n+=20),t.totalClicks>5&&(n+=10),t.pageViews>5&&(n+=10),n>=70?"high":n>=40?"medium":"low"},getEngagementQuality:function(t,e){const n=t.scrollDepth.length>0?t.scrollDepth.reduce((t,e)=>t+e,0)/t.scrollDepth.length:0;let i=0;return i+=5*t.pageViews,i+=e/1e3*.1,i+=2*t.totalClicks,i+=.5*n,i>=100?"high":i>=50?"medium":"low"},getDeviceTier:function(){const e=navigator.deviceMemory||4,n=navigator.hardwareConcurrency||4,i=t.screen,a=i.width*i.height;return e>=8&&n>=8&&a>2073600?"premium":e>=4&&a>921600?"mid_range":"budget"},getAttributionConfidence:function(){let n=.3;const i=new URLSearchParams(t.location.search);return(i.get("affiliate")||i.get("ref"))&&(n+=.4),i.get("utm_source")&&(n+=.2),e.referrer&&["instagram.com","tiktok.com","youtube.com","facebook.com"].some(t=>e.referrer.includes(t))&&(n+=.1),Math.min(n,1)},updateMetrics:function(t,e){switch(t){case"page_view":this.behaviorMetrics.pageViews++;break;case"product_view":case"product_impression":this.behaviorMetrics.productViews++;break;case"cart_update":this.behaviorMetrics.cartActions++;break;case"scroll_milestone":e&&e.scroll_percent&&this.behaviorMetrics.scrollDepth.push(e.scroll_percent);break;case"variant_selection":case"product_impression":this.behaviorMetrics.totalClicks++}},sendAnalysis:function(){const e=this.analyzeBehavior();t.InfluencerTracker&&t.InfluencerTracker.track("ai_session_analysis",{session_analysis:e,session_duration:Date.now()-this.sessionStart,total_events:Object.values(this.behaviorMetrics).reduce((t,e)=>Array.isArray(e)?t+e.length:t+e,0)})}};if(t.InfluencerTracker){const e=t.InfluencerTracker.track;t.InfluencerTracker.track=function(t,i={}){n.updateMetrics(t,i),e.call(this,t,i)},t.InfluencerTracker.getAIAnalysis=function(){return n.analyzeBehavior()}}setInterval(()=>{n.sendAnalysis()},3e5),t.addEventListener("beforeunload",()=>{n.sendAnalysis()}),t.AISessionAnalyzer=n,console.log("🤖 AI Session Analyzer integrated with existing customer_sessions")}(t,e),function(t){t.InfluencerTrackerUtils={debounce:function(t,e,n){let i;return function(){const a=this,o=arguments,r=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(a,o)},e),r&&t.apply(a,o)}},throttle:function(t,e){let n;return function(){const i=arguments;n||(t.apply(this,i),n=!0,setTimeout(()=>n=!1,e))}},getElementPosition:function(t){const e=t.getBoundingClientRect();return{x:Math.round(e.left),y:Math.round(e.top),width:Math.round(e.width),height:Math.round(e.height)}},parseCurrency:function(t){if(!t)return null;let e=(t=String(t).trim()).replace(/[^\d.,\-]/g,"");if(e.includes(",")&&e.includes("."))e=e.lastIndexOf(",")>e.lastIndexOf(".")?e.replace(/\./g,"").replace(",","."):e.replace(/,/g,"");else if(e.includes(",")){const t=e.split(",");e=2===t.length&&t[1].length<=2?e.replace(",","."):e.replace(/,/g,"")}const n=parseFloat(e);return n>1e4?n/100:isNaN(n)?null:n},isElementVisible:function(n){const i=n.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(t.innerHeight||e.documentElement.clientHeight)&&i.right<=(t.innerWidth||e.documentElement.clientWidth)},getScrollPercentage:function(){const n=t.pageYOffset||e.documentElement.scrollTop,i=e.documentElement.scrollHeight-t.innerHeight;return Math.round(n/i*100)},setCookie:function(t,n,i){const a=i?`; expires=${new Date(Date.now()+864e5*i).toUTCString()}`:"";e.cookie=`${t}=${n}${a}; path=/`},getCookie:function(t){return e.cookie.split("; ").reduce((e,n)=>{const i=n.split("=");return i[0]===t?decodeURIComponent(i[1]):e},"")},setStorage:function(t,e,n=!1){try{return(n?sessionStorage:localStorage).setItem(t,JSON.stringify(e)),!0}catch(i){return console.warn("Storage not available, using cookie fallback"),this.setCookie(t,JSON.stringify(e),n?null:30),!1}},getStorage:function(t,e=!1){try{const n=(e?sessionStorage:localStorage).getItem(t);return n?JSON.parse(n):null}catch(e){const n=this.getCookie(t);return n?JSON.parse(n):null}}}}(t)}("undefined"!=typeof window?window:this,"undefined"!=typeof document?document:{});