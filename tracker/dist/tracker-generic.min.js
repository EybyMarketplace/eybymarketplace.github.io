/* Influencer Tracker v2.1.0 with AI | Built: 2025-09-01T19:49:09.994Z */
!function(e,t){"use strict";void 0!==e&&(e.InfluencerTrackerBuild={name:"generic",version:"2.1.0",timestamp:"2025-09-01T19:49:10.809Z",files:["src/core/tracker-core.js","src/ai/ai-data-collector.js","src/utils/helpers.js"],features:{tracking:!0,attribution:!0,adapters:!0,ai:!0}}),function(e,t){const n={apiEndpoint:"",projectId:"",enableConsentCheck:!0,batchSize:10,batchTimeout:3e3,sessionTimeout:18e5,version:"2.0.0"},i={checkConsent:function(){return!n.enableConsentCheck||"granted"===localStorage.getItem("analytics_consent")},waitForConsent:function(e){const t=setInterval(()=>{this.checkConsent()&&(clearInterval(t),e())},500);setTimeout(()=>{clearInterval(t)},1e4)}},r={generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getUserId:function(){let e=localStorage.getItem("inf_user_id");return e||(e=this.generateUUID(),localStorage.setItem("inf_user_id",e)),e},getSessionId:function(){let e=sessionStorage.getItem("inf_session");if(e){const t=JSON.parse(e),i=Date.now();if(i-t.lastActivity<n.sessionTimeout)return t.lastActivity=i,sessionStorage.setItem("inf_session",JSON.stringify(t)),t.id}const t={id:this.generateUUID(),startTime:Date.now(),lastActivity:Date.now()};return sessionStorage.setItem("inf_session",JSON.stringify(t)),t.id}},o={detectInfluencer:function(){const n=new URLSearchParams(e.location.search),i=new URLSearchParams(e.location.hash.substring(1)),r={influencer_id:n.get("inf_id")||n.get("influencer")||i.get("inf_id"),campaign_id:n.get("camp_id")||n.get("campaign")||i.get("camp_id"),promo_code:n.get("promo")||n.get("codigo")||i.get("promo"),utm_source:n.get("utm_source"),utm_medium:n.get("utm_medium"),utm_campaign:n.get("utm_campaign"),ref:n.get("ref")},o=t.referrer;let s=null;if(o.includes("instagram.com")?s="instagram":o.includes("tiktok.com")?s="tiktok":o.includes("youtube.com")||o.includes("youtu.be")?s="youtube":o.includes("facebook.com")?s="facebook":(o.includes("twitter.com")||o.includes("x.com"))&&(s="twitter"),Object.values(r).some(e=>null!==e)||s){const t={...r,social_source:s,detected_at:Date.now(),landing_page:e.location.href};return sessionStorage.setItem("inf_attribution",JSON.stringify(t)),t}const c=sessionStorage.getItem("inf_attribution");return c?JSON.parse(c):null}},s={generate:function(){const t=e.screen,n=navigator;return{user_agent:n.userAgent,language:n.language,platform:n.platform,screen_resolution:`${t.width}x${t.height}`,color_depth:t.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,device_memory:n.deviceMemory||null,hardware_concurrency:n.hardwareConcurrency||null,connection:n.connection?{effective_type:n.connection.effectiveType,downlink:n.connection.downlink}:null}}},c={queue:[],add:function(e){this.queue.push(e),this.queue.length>=n.batchSize&&this.flush()},flush:function(){if(0===this.queue.length||!n.apiEndpoint)return;const e=this.queue.splice(0,n.batchSize);fetch(n.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:n.projectId,events:e,version:n.version})}).catch(t=>{console.warn("Influencer Tracker: Failed to send events",t);const n=JSON.parse(localStorage.getItem("inf_failed_events")||"[]");n.push(...e),localStorage.setItem("inf_failed_events",JSON.stringify(n.slice(-100)))})},scheduleFlush:function(){this.flushTimer&&clearTimeout(this.flushTimer),this.flushTimer=setTimeout(()=>this.flush(),n.batchTimeout)}},InfluencerTracker={initialized:!1,startTime:Date.now(),platform:"generic",adapter:null,init:function(e={}){this.initialized||(Object.assign(n,e),n.apiEndpoint?(this.platform=this.detectPlatform(),console.log(`ðŸŽ¯ Plataforma detectada: ${this.platform}`),this.adapter=this.loadAdapter(this.platform),!n.enableConsentCheck||i.checkConsent()?this.startTracking():i.waitForConsent(()=>this.startTracking())):console.warn("Influencer Tracker: apiEndpoint nÃ£o configurado"))},detectPlatform:function(){return e.Shopify||e.shopifyData||t.querySelector('meta[name="shopify-checkout-api-token"]')?"shopify":"generic"},loadAdapter:function(t){return e[`${t}Adapter`]||null},startTracking:function(){this.initialized=!0;const n=o.detectInfluencer();this.track("page_view",{page_url:e.location.href,page_title:t.title,referrer:t.referrer,influencer_data:n}),this.setupUniversalTracking(),this.adapter?.init&&this.adapter.init(),c.scheduleFlush(),e.addEventListener("beforeunload",()=>c.flush()),console.log("Influencer Tracker: Inicializado com sucesso")},track:function(t,n={}){if(!this.initialized)return;const i={event_id:r.generateUUID(),event_type:t,timestamp:Date.now(),user_id:r.getUserId(),session_id:r.getSessionId(),page_url:e.location.href,device_fingerprint:s.generate(),platform:this.platform,properties:n};this.adapter?.enrichEvent&&Object.assign(i.properties,this.adapter.enrichEvent(t,n)),c.add(i)},setupUniversalTracking:function(){let n=0;e.addEventListener("scroll",this.throttle(()=>{const i=Math.round(e.scrollY/(t.body.scrollHeight-e.innerHeight)*100);i>n&&(n=i,[25,50,75,90].includes(i)&&this.track("scroll_milestone",{scroll_percent:i}))},1e3));let i=0;setInterval(()=>{i+=10,[30,60,120,300].includes(i)&&this.track("time_milestone",{seconds_on_page:i})},1e4),this.setupExitTracking()},setupExitTracking:function(){let n=!1;t.addEventListener("mouseleave",i=>{i.clientY<=0&&!n&&(n=!0,this.track("exit_intent",{time_on_page:Date.now()-this.startTime,scroll_percent:Math.round(e.scrollY/(t.body.scrollHeight-e.innerHeight)*100)}))})},trackPurchase:function(e){this.track("purchase",{order_id:e.orderId,total_value:e.totalValue,currency:e.currency||"BRL",items:e.items,coupon_code:e.couponCode,influencer_attribution:JSON.parse(sessionStorage.getItem("inf_attribution")||"null")})},trackCustomEvent:function(e,t){this.track(e,t)},throttle:function(e,t){let n;return function(){const i=arguments;n||(e.apply(this,i),n=!0,setTimeout(()=>n=!1,t))}}};e.InfluencerTracker=InfluencerTracker,e.InfluencerTracker.ConsentManager=i,e.InfluencerTracker.IdGenerator=r,e.InfluencerTracker.InfluencerDetector=o,e.InfluencerTracker.DeviceFingerprint=s,e.InfluencerTracker.EventQueue=c}(e,t),function(e,t){const n={sessionStart:Date.now(),behaviorMetrics:{pageViews:0,productViews:0,cartActions:0,totalClicks:0,scrollDepth:[],timeOnPages:[]},analyzeBehavior:function(){const e=Date.now()-this.sessionStart,t=this.behaviorMetrics;return{behavioral_segment:this.getBehavioralSegment(t,e),conversion_probability:this.getConversionProbability(t,e),engagement_quality:this.getEngagementQuality(t,e),device_tier:this.getDeviceTier(),attribution_confidence:this.getAttributionConfidence()}},getBehavioralSegment:function(e,t){return e.cartActions>0&&t<3e5?"decisive_buyer":e.cartActions>2?"hesitant_buyer":e.productViews>5&&0===e.cartActions?"researcher":e.totalClicks>10?"price_conscious":"casual_browser"},getConversionProbability:function(e,t){let n=0;return e.cartActions>0&&(n+=40),e.productViews>3&&(n+=20),t>18e4&&(n+=20),e.totalClicks>5&&(n+=10),e.pageViews>5&&(n+=10),n>=70?"high":n>=40?"medium":"low"},getEngagementQuality:function(e,t){const n=e.scrollDepth.length>0?e.scrollDepth.reduce((e,t)=>e+t,0)/e.scrollDepth.length:0;let i=0;return i+=5*e.pageViews,i+=t/1e3*.1,i+=2*e.totalClicks,i+=.5*n,i>=100?"high":i>=50?"medium":"low"},getDeviceTier:function(){const t=navigator.deviceMemory||4,n=navigator.hardwareConcurrency||4,i=e.screen,r=i.width*i.height;return t>=8&&n>=8&&r>2073600?"premium":t>=4&&r>921600?"mid_range":"budget"},getAttributionConfidence:function(){let n=.3;const i=new URLSearchParams(e.location.search);return(i.get("affiliate")||i.get("ref"))&&(n+=.4),i.get("utm_source")&&(n+=.2),t.referrer&&["instagram.com","tiktok.com","youtube.com","facebook.com"].some(e=>t.referrer.includes(e))&&(n+=.1),Math.min(n,1)},updateMetrics:function(e,t){switch(e){case"page_view":this.behaviorMetrics.pageViews++;break;case"product_view":this.behaviorMetrics.productViews++;break;case"add_to_cart":case"remove_from_cart":this.behaviorMetrics.cartActions++;break;case"click":this.behaviorMetrics.totalClicks++;break;case"scroll":t&&t.scroll_percent&&this.behaviorMetrics.scrollDepth.push(t.scroll_percent)}},sendAnalysis:function(){const t=this.analyzeBehavior();e.InfluencerTracker&&e.InfluencerTracker.track("ai_session_analysis",{session_analysis:t,session_duration:Date.now()-this.sessionStart,total_events:Object.values(this.behaviorMetrics).reduce((e,t)=>Array.isArray(t)?e+t.length:e+t,0)})}};if(e.InfluencerTracker){const t=e.InfluencerTracker.track;e.InfluencerTracker.track=function(e,i={}){n.updateMetrics(e,i),t.call(this,e,i)},e.InfluencerTracker.getAIAnalysis=function(){return n.analyzeBehavior()}}setInterval(()=>{n.sendAnalysis()},3e5),e.addEventListener("beforeunload",()=>{n.sendAnalysis()}),e.AISessionAnalyzer=n,console.log("ðŸ¤– AI Session Analyzer integrated with existing customer_sessions")}(e,t),function(e){e.InfluencerTrackerUtils={debounce:function(e,t,n){let i;return function(){const r=this,o=arguments,s=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(r,o)},t),s&&e.apply(r,o)}},throttle:function(e,t){let n;return function(){const i=arguments;n||(e.apply(this,i),n=!0,setTimeout(()=>n=!1,t))}},getElementPosition:function(e){const t=e.getBoundingClientRect();return{x:Math.round(t.left),y:Math.round(t.top),width:Math.round(t.width),height:Math.round(t.height)}},parseCurrency:function(e){if(!e)return null;let t=(e=String(e).trim()).replace(/[^\d.,\-]/g,"");if(t.includes(",")&&t.includes("."))t=t.lastIndexOf(",")>t.lastIndexOf(".")?t.replace(/\./g,"").replace(",","."):t.replace(/,/g,"");else if(t.includes(",")){const e=t.split(",");t=2===e.length&&e[1].length<=2?t.replace(",","."):t.replace(/,/g,"")}const n=parseFloat(t);return n>1e4?n/100:isNaN(n)?null:n},isElementVisible:function(n){const i=n.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(e.innerHeight||t.documentElement.clientHeight)&&i.right<=(e.innerWidth||t.documentElement.clientWidth)},getScrollPercentage:function(){const n=e.pageYOffset||t.documentElement.scrollTop,i=t.documentElement.scrollHeight-e.innerHeight;return Math.round(n/i*100)},setCookie:function(e,n,i){const r=i?`; expires=${new Date(Date.now()+864e5*i).toUTCString()}`:"";t.cookie=`${e}=${n}${r}; path=/`},getCookie:function(e){return t.cookie.split("; ").reduce((t,n)=>{const i=n.split("=");return i[0]===e?decodeURIComponent(i[1]):t},"")},setStorage:function(e,t,n=!1){try{return(n?sessionStorage:localStorage).setItem(e,JSON.stringify(t)),!0}catch(i){return console.warn("Storage not available, using cookie fallback"),this.setCookie(e,JSON.stringify(t),n?null:30),!1}},getStorage:function(e,t=!1){try{const n=(t?sessionStorage:localStorage).getItem(e);return n?JSON.parse(n):null}catch(t){const n=this.getCookie(e);return n?JSON.parse(n):null}}}}(e)}("undefined"!=typeof window?window:this,"undefined"!=typeof document?document:{});